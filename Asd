    # Marcamos cuáles registros son "reactivaciones":
    # ID que estaba dado de baja en el último histórico y vuelve a aparecer en la base.
    if "OBS_CAMBIO_prev" in merged.columns:
        obs_prev = merged["OBS_CAMBIO_prev"].fillna("")
    else:
        # Si la columna no existe (por histórico viejo), creamos una serie vacía
        obs_prev = pd.Series("", index=merged.index)

    merged["ES_REACTIVACION"] = (
        (merged["_merge"] == "both") &
        obs_prev.str.contains("Dado de baja", case=False, na=False)
    )
